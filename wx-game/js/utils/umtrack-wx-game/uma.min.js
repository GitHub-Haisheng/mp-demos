"use strict";function e(e){t(wx.request,e)}function t(e,t){var n=t.success,i=t.fail,r=!1,o=null;t.success=function(e){if(!r){o&&clearTimeout(o);"function"==typeof n&&n(e)}};t.fail=function(){if(!r){o&&clearTimeout(o);"function"==typeof i&&i()}};e(t);o=setTimeout(()=>{o&&clearTimeout(o);r=!0;"function"==typeof i&&i(r)},t.timeout||F)}function n(t){try{e(t)}catch(e){D().e("请求失败: "+e)}}function i(e){return ne.encode(e,!1)}function r(e){return ne.decode(e)}function o(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(e);i++)t+=n[Math.round(Math.random()*(n.length-1))];return t}function u(e){return!Number.isNaN(parseInt(e,10))}function s(e,t){for(var n=String(e).split("."),i=String(t).split("."),r=0;r<Math.max(n.length,i.length);r++){var o=parseInt(n[r]||0,10),u=parseInt(i[r]||0,10);if(o>u)return 1;if(o<u)return-1}return 0}function a(e){return JSON.parse(JSON.stringify(e))}function c(e,t){return!(!e||!t||0===t.length||t.length>e.length)&&e.substr(0,t.length)===t}function f(e,t){return!(!t||0===e.length||t.length>e.length)&&e.substring(e.length-t.length)===t}function l(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}function p(e,t){if(e===t)return!0;if(e&&"object"==typeof e&&t&&"object"==typeof t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e){if(Object.prototype.hasOwnProperty.call(t,n))return!1;if(!p(e[n],t[n]))return!1}return!0}return!1}function d(e,t){if(!e)return"";if("string"==typeof t&&t.length){var n=new RegExp("^"+t+"*");e=e.replace(n,"")}else e=e.replace(/^s*/,"");return e}function h(e,t){if(!e)return"";var n,i;if("string"==typeof t&&t.length){n=new RegExp(t);i=e.length;for(;n.test(e.charAt(i));)i-=1;return e.slice(0,i+1)}n=/s/;i=e.length-1;for(;n.test(e.charAt(i));)i-=1;return e.slice(0,i+1)}function g(e){var t=null;switch(e){case me.HALF_SESSION:t=v();break;case me.CLOSE_SESSION:t=_();break;case me.EKV:t=y()}return t}function v(){var e=null,t=Ee().cloneCurrentSession();t&&(e={header:{st:"1"},analytics:{sessions:[t]}});return e}function _(){var e=null,t={},n=Ee().cloneCurrentSession();if(n){var i=j().get(),r=ue().get();Array.isArray(i)&&i.length&&(n.pages=ie.clone(i));Array.isArray(r)&&r.length&&(n.shares=ie.clone(r));j().clear();ue().clear();t.sessions=[n]}var o=fe().getEkvs();if(o){t.ekvs=ie.clone(o);fe().clear()}(t.sessions||t.ekvs)&&(e={analytics:t});return e}function y(){var e=null,t=fe().getEkvs();if(t){e={analytics:{ekvs:ie.clone(t)}};fe().clear()}return e}function m(e){return{h:E(e.header,Se),a:S(e.analytics,Ie)}}function E(e,t){var n=I(e,t);e.id_tracking&&(n[t.id_tracking||"id_tracking"]=I(e.id_tracking,Te));return n}function I(e,t){var n={};for(var i in e)t[i]?n[t[i]]=e[i]:n[i]=e[i];return n}function S(e,t){var n={};if(e)for(var i in e)e[i]&&(n[t[i]]=e[i]);return n}function T(e,t,i,r){ye.instance().setIdType(re().getIdType());ye.instance().setIdTracking(re().getIdTracking());var o=re().getUserId();o&&e.analytics&&(e.analytics.active_user={puid:o,provider:re().getProvider()});var u=ie.clone(ye.instance().get());e.header=ie.assign(u,e.header,{ts:Date.now(),testToken:Oe().getToken(),traceId:ie.getRandomStr(10)+Date.now()+ie.getRandomStr(9)});var s=m(e),a=L.stringify(s),c={url:M.LOG_URL,method:"POST",data:ie.base64Encode(a),success:function(n){var r=n.code||n.status||n.statusCode;if(200===r||413===r){D().i("数据发送成功: ",e,a);N((n.data||{}).imprint);"function"==typeof t&&t(n)}else{D().w("数据发送失败: ",a);"function"==typeof i&&i()}},fail:function(e){D().w("超时: ",a);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};n(ie.assign(c,A()))}function N(e){if(e){C().set(M.IMPRINT,e);ye.instance().setItem(M.IMPRINT,e);var t=L.parse(ie.base64Decode(e));D().v("imprint: %o",t);var n=t.report_policy;if(n&&ie.isNumber(n)){C().set(M.REPORT_POLICY,n);if(n===M.REPORT_POLICY_INTERVAL){var i=t.report_interval;if(i&&ie.isNumber(i)){i<=M.EVENT_SEND_MIN_INTERVAL?i=M.EVENT_SEND_MIN_INTERVAL:i>M.EVENT_SEND_MAX_INTERVAL&&(i=M.EVENT_SEND_MAX_INTERVAL);C().set(M.REPORT_INTERVAL_TIME,i)}}}t.ttn_invalid&&Oe().clear()}}function A(){;"wxmp/json";return{header:{"Content-Type":"wxmp/json","Msg-Type":"wxmp/json"}}}function O(e){var t=e,n=[];this.enqueue=function(e){"number"==typeof t&&this.size()>=t&&this.dequeue();n.push(e)};this.dequeue=function(){return n.shift()};this.front=function(){return n[0]};this.isEmpty=function(){return 0===n.length};this.clear=function(){n.length=0};this.size=function(){return n.length};this.items=function(){return n};this.print=function(){console.log(n.toString())}}function w(e,t){this.id=e;this.ts=Date.now();var n=typeof t;if("string"===n&&t)this[e]=t;else if("object"===n)for(var i in t)({}).hasOwnProperty.call(t,i)&&(this[i]=t[i])}function R(){function e(){re().init(function(){ye.instance().init();D().v("Header初始化成功")})}function t(e,t){return"number"!=typeof o||"number"!=typeof t||(o<=0||e-o>t)}function n(e,t){if(!e||"string"!=typeof e){D().e('please check trackEvent id. id should be "string" and not null');return!1}var n={id:1,ts:1,du:1};if(n[e]){D().e("eventId不能与以下保留字冲突: "+n.join(","));return!1}if(e.length>M.MAX_EVENTID_LENGTH){D().e("The maximum length of event id shall not exceed "+M.MAX_EVENTID_LENGTH);return!1}if(t&&("object"!=typeof t||Array.isArray(t))&&"string"!=typeof t){D().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof t){var i=0;for(var r in t)if({}.hasOwnProperty.call(t,r)){if(r.length>M.MAX_PROPERTY_KEY_LENGTH){D().e("The maximum length of property key shall not exceed "+M.MAX_PROPERTY_KEY_LENGTH);return!1}if(i>=M.MAX_PROPERTY_KEYS_COUNT){D().e("The maximum count of properties shall not exceed "+M.MAX_PROPERTY_KEYS_COUNT);return!1}if(n[r]){D().e("属性中的key不能与以下保留字冲突: "+n.join(","));return!1}i+=1}}return!0}var i=!1,r=!1,o=0;this.init=function(t){D().v("sdk version: "+M.IMPL_VERSION);i?D().v("Lib重复实例化"):C().load(function(){D().v("cache初始化成功: ",C().getAll());e();i=!0;"function"==typeof t&&t();D().tip("SDK集成成功")})};this.resume=function(e){if(i&&!r){D().v("showOptions: ",e);var t=this;r=!0;var n=Ee().resume(e),o=Ee().getCurrentSessionId();fe().setSessionId(o);Oe().init(function(){we().load();n&&we().add(me.HALF_SESSION,{},function(){b().useOpenid()&&b().autoGetOpenid()&&!re().getId()?re().getOpenIdAsync({success:function(e){D().v("获取openid成功: %s",e);t.setOpenid(e)},fail:function(){D().v("获取openid失败")}}):we().send()})})}};this.pause=function(){if(i){r=!1;o=0;Ee().pause();b().uploadUserInfo()&&Re().update();we().send(me.CLOSE_SESSION,{},function(){we().save();C().save();D().v("cache save success")})}};this.setOpenid=function(e){D().v("setOpenId: %s",e);re().setOpenid(e);we().send()};this.setUnionid=function(e){D().v("setUnionid: %s",e);re().setUnionid(e)};this.setUserid=function(e,t){D().v("setUserid: %s",e,t);re().setUserid(e,t)};this.trackEvent=function(e,r){if(i){D().v("event: ",e,r);if(n(e,r)){var u=new w(e,r);fe().addEvent(u);var s=!!Oe().getToken(),a=s?0:M.EVENT_SEND_DEFAULT_INTERVAL,c=Date.now();if(t(c,a)){o=c;we().send(me.EKV,{noCache:s},function(){})}}}};this.trackShare=function(e){if(i){try{e=ue().add(e);D().v("sharePath: ",e.path)}catch(e){D().v("shareAppMessage: ",e)}return e}};this.trackPageStart=function(e){i&&j().addPageStart(e)};this.trackPageEnd=function(e){i&&j().addPageEnd(e)};this.onShareAppMessage=function(e){let t=this;wx.onShareAppMessage(function(){return t.trackShare(e())})};this.shareAppMessage=function(e){this.trackShare(e);wx.shareAppMessage(e)}}function k(){}var U="[UMENG] -- ",D=function(){function e(){this.setDebug=function(e){n=e};this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.debug.apply(console,arguments)}catch(e){}};this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.info.apply(console,arguments)}catch(e){}}catch(e){}};this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.error.apply(console,arguments)}catch(e){}};this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.warn.apply(console,arguments)}catch(e){}};this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(e){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.tip_w=function(){try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.warn.apply(console,arguments)}catch(e){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=U+arguments[0]);console.error.apply(console,arguments)}catch(e){}}}var t=null,n=!1;return function(){null===t&&(t=new e);return t}}(),P={set:function(e,t,n){var i,r={key:e,success:function(e){"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n()}};r.data=t;i=wx.setStorage;try{i&&i(r)}catch(e){D.e("存储错误",e)}},get:function(e,t){var n;n=wx.getStorage;try{n&&n({key:e,success:function(e){"function"==typeof t&&t(e.data)},fail:function(n){D().w(e+": "+n.errMsg);"function"==typeof t&&t()}})}catch(e){D.e("获取storage错误",e)}},remove:function(e,t){var n;n=wx.removeStorage;try{n&&n({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}})}catch(e){D.e("删除storage错误",e)}}},L={stringify:function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},parse:function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},parseToArray:function(e){if(e)try{return JSON.parse(e)}catch(e){}return[]}},b=function(){function e(){var e={};this.useOpenid=function(){return e.useOpenid};this.autoGetOpenid=function(){return e.autoGetOpenid};this.appKey=function(){return e.appKey};this.uploadUserInfo=function(){return e.uploadUserInfo};this.set=function(t){e=t};this.get=function(){return e};this.setItem=function(t,n){e[t]=n};this.getItem=function(t){return e[t]}}var t=null;return function(){t||(t=new e);return t}}(),C=function(){function e(){this.load=function(e){if(i){P.remove(n);e()}else{n="um_cache_"+b().appKey();P.get(n,function(t){i=L.parse(t)||{};r=!0;P.remove(n);e()})}};this.save=function(){i&&P.set(n,L.stringify(i))};this.set=function(e,t){i&&(i[e]=t)};this.get=function(e){return(i||{})[e]};this.remove=function(e){i&&i[e]&&delete i[e]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(e){return!!this.get(e)};this.isLoaded=function(){return r}}var t=null,n="",i=null,r=!1;return function(){t||(t=new e);return t}}(),x="",M={SESSION_INTERVAL:3e4,LOG_URL:x="https://umini.shujupie.com/wxm_logs",GET_OPENID_URL:"https://umini.shujupie.com/uminiprogram_logs/wx/getuut",USERINFO_URL:"https://umini.shujupie.com/uminiprogram_logs/comm/uif",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.3.2",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},V={getUserInfo:function(e){wx.getSetting({success(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){e(t&&t.userInfo)},fail:function(){e({})}}):e({})},fail(){e({})}})},getSystemInfo:function(e,t){wx.getSystemInfo({success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(e){"function"==typeof e&&e()},checkNetworkAvailable:function(e){var t={success:function(t){var n=!1;n="none"!==t.networkType;"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e()}};wx.getNetworkType(t)},getNetworkInfo:function(e,t){var n={success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}};wx.getNetworkType(n)},getDeviceId:function(e,t){try{"function"==typeof e&&e("")}catch(e){D().e("getDeviceId error",e)}},getAdvertisingId:function(e,t){"function"==typeof e&&e("")},getPageName:function(){},onNetworkStatusChange:function(e){wx.onNetworkStatusChange(function(t){"function"==typeof e&&e(t.isConnected||!0)})}},j=function(){function e(){var e=!1,t=null,n=[];this.addPageStart=function(n){if(n&&!e){t={ts:Date.now(),path:n,page_name:n};e=!0}};this.addPageEnd=function(i){if(e&&i&&t&&i===t.page_name){var r=Date.now()-t.ts;t.duration=Math.abs(r);n.push(t);t=null;e=!1}};this.get=function(){return n};this.getCurrentPage=function(){return t};this.clear=function(){n.length=0}}var t=null;return function(){t||(t=new e);return t}}(),F=5e3,K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",G=function(e){for(var t={},n=0,i=e.length;n<i;n++)t[e.charAt(n)]=n;return t}(K),Y=String.fromCharCode,H=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?Y(192|t>>>6)+Y(128|63&t):Y(224|t>>>12&15)+Y(128|t>>>6&63)+Y(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return Y(240|t>>>18&7)+Y(128|t>>>12&63)+Y(128|t>>>6&63)+Y(128|63&t)},q=function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,H)},X=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[K.charAt(n>>>18),K.charAt(n>>>12&63),t>=2?"=":K.charAt(n>>>6&63),t>=1?"=":K.charAt(63&n)].join("")},J=function(e){return e.replace(/[\s\S]{1,3}/g,X)},W=function(e){return J(q(e))},z=function(e,t){return t?W(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):W(String(e))},Q=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),B=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return Y(55296+(t>>>10))+Y(56320+(1023&t));case 3:return Y((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return Y((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Z=function(e){return e.replace(Q,B)},$=function(e){var t=e.length,n=t%4,i=(t>0?G[e.charAt(0)]<<18:0)|(t>1?G[e.charAt(1)]<<12:0)|(t>2?G[e.charAt(2)]<<6:0)|(t>3?G[e.charAt(3)]:0),r=[Y(i>>>16),Y(i>>>8&255),Y(255&i)];r.length-=[0,0,2,1][n];return r.join("")},ee=function(e){return e.replace(/[\s\S]{1,4}/g,$)},te=function(e){return Z(ee(e))},ne={encode:z,decode:function(e){return te(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},ie={base64Encode:i,base64Decode:r,isNumber:u,compareVersion:s,getRandomStr:o,clone:a,startsWith:c,endsWith:f,assign:l,deepEqual:p,trimStart:d,trimEnd:h},re=function(){function e(){function e(){return ie.getRandomStr(10)+Date.now()+ie.getRandomStr(7)+M.UUID_SUFFIX}var t="",i="",r="",o="",u="",s="";this.init=function(n){s=b().useOpenid()?"openid":"uuid";P.get(M.UUID,function(o){if(o)t=o;else{t=e();P.set(M.UUID,t)}b.useOpenid?P.get(M.OPENID,function(e){i=e;n&&n()}):n&&n();P.get(M.UNIONID,function(e){r=e})})};P.get(M.USERID,function(e){!o&&e&&(o=e)});P.get(M.PROVIDER,function(e){!u&&e&&(u=e)});this.getOpenIdAsync=function(e){wx.login({success:function(t){t.code?n({url:M.GET_OPENID_URL,method:"GET",data:{key:b().appKey(),code:t.code},success:function(t){if(t&&200===t.statusCode&&t.data&&t.data.data){var n=t.data.data;return e.success&&e.success(n.oid,n.uid)}e.fail&&e.fail()},fail:function(){e.fail&&e.fail()}}):e.fail&&e.fail()},fail:function(){e.fail&&e.fail()}})};this.getIdType=function(){return s};this.getIdTracking=function(){var e={};t&&(e.uuid=t);i&&(e.openid=i);r&&(e.unionid=r);o&&(e.userid=o);return e};this.setOpenid=function(e){if(e&&e!==i){i=e;P.set(M.OPENID,e)}};this.setUnionid=function(e){if(!r&&e){r=e;P.set(M.UNIONID,e)}};this.setUserid=function(e,t){if(e&&e!==o){o=e;P.set(M.USERID,e);u=t;P.set(M.PROVIDER,t)}};this.getId=function(){return b().useOpenid()?i:t};this.getUserId=function(){return o};this.getProvider=function(){return u}}var t=null;return function(){t||(t=new e);return t}}(),oe=3,ue=function(){function e(){return{add:function(e){D().v("share origin: %o",e);var t={title:e&&e.title,path:e&&e.path&&e.path.split("?")[0],_um_sts:Date.now()};t.path&&t.path.length>1&&ie.startsWith(t.path,"/")&&(t.path=ie.trimStart(t.path,"/"));var r=e.path||"",o=re().getId();if(o){var u=i.split(","),s=(u=u.filter(function(e){return e.length>0})).indexOf(o);s>=0&&(u=u.slice(0,s));u.length<oe&&u.push(o);var a=u.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+a:r+="?_um_ssrc="+a;var c=Date.now();r+="&_um_sts="+c;e.path=r;e.query=e.query?e.query+"&_um_ssrc="+a+"&_um_sts="+c:"_um_ssrc="+a+"&_um_sts="+c;t._um_ssrc=a;t._um_sts=c}n.push(t);D().v("share: %o",e);return e},setShareSource:function(e){i=e},clear:function(){n.length=0},get:function(){return n}}}var t=null,n=[],i="";return function(){t||(t=new e);return t}}(),se="ekvs",ae=1e4,ce=1,fe=function(){function e(){if(u.length){var e=C().get(se);if(n(e)+u.length<=ae){e=t(e,u);C().set(se,e)}}}function t(e,t){var n=(e=e||{})[o];Array.isArray(n)&&n.length?e[o]=n.concat(t):e[o]=[].concat(t);return e}function n(e){var t=0;for(var n in e)Array.isArray(e[n])&&(t+=e[n].length);return t}function i(){return{addEvent:function(t){if(o){u.unshift(t);if(u.length>ce){e(o);u.length=0}}else{D().w("session id is null: ",o);s.unshift(t)}},setSessionId:function(e){o=e;D().v("setSessionId: ",o);if(Array.isArray(s)&&s.length&&o){for(var t=0;t<s.length;t++)this.addEvent(s[t]);s.length=0}},getEkvs:function(){var e=C().get(se);u&&u.length&&(e=t(e,u));return e},clear:function(){C().remove(se);u.length=0}}}var r,o,u=[],s=[];return function(){r||(r=i());return r}}(),le={getClipboard:function(e){var t;t=wx.getClipboardData;try{t&&t({success:function(t){var n=t.data;"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e("")}})}catch(e){D.e("读取clipboard发生错误",e)}},showModal:function(e){var t;t=wx.showModal;try{t&&t(e)}catch(e){D.e("展示Modal时发生错误",e)}},showToast:function(e){var t;t=wx.showToast;try{t&&t(e)}catch(e){D.e("showToast error",e)}},getUserInfo:function(e){var t,n={fail:function(){e&&e()}};t=wx.getUserInfo;n.success=function(t){if(t&&t.userInfo){var n=t.userInfo;e&&e({avatar:n.avatarUrl,nickName:n.nickName,gender:n.gender,country:n.country,province:n.province,city:n.city,language:n.language})}};try{wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]&&t&&t(n)},fail:function(){e()}})}catch(e){D.e("showToast error",e)}},getAppInfoSync:function(){return{}}},pe="2g",de="3g",he="4g",ge="none",ve=" ",_e=["access","access_subtype"],ye=function(){function e(){function e(e){V.getSystemInfo(function(i){V.getNetworkInfo(function(o){var u=(o=o||{}).type||o.networkType;u===ge&&(u="unknown");var s=C().get(M.IMPRINT);s&&(r.imprint=s);t(i,u);n(i);e&&e()})})}function t(e,t,n){r.userInfo=n;r.device_type="Phone";r.sdk_version=M.IMPL_VERSION;r.appkey=b().appKey();if(e){var i,o,u,s=e.model||"",a=(e.product,e.platform||""),c=e.brand||"",f=c.toLowerCase();r.platform_sdk_version=e.SDKVersion;r.platform_version=e.version;u=(i=Math.round(e.screenWidth*e.pixelRatio))>(o=Math.round(e.screenHeight*e.pixelRatio))?i+"*"+o:o+"*"+i;r.os=a;r.font_size_setting=e.fontSizeSetting;r.device_model=s;r.device_brand=c;r.device_manufacturer=f;r.device_manuid=s.toLowerCase().indexOf(f)>-1?s:f+ve+s;r.device_name=s.toLowerCase().indexOf(f)>-1?s:f+ve+s;r.os_version=e.system;r.resolution=u;r.language=e.language}switch(t=t?t.toLowerCase():""){case he:r.access_subtype="LTE";r.access="4G";break;case de:r.access_subtype="CDMA";r.access="3G";break;case pe:r.access_subtype="GRPS";r.access="2G";break;default:r.access=t;delete r.access_subtype}}function n(e){var t=[];if(e){t.push({name:"系统名",value:e.platform});t.push({name:"支付宝版本号",value:e.version})}t.push({name:"设备型号",value:r.device_model});t.push({name:"设备生产商",value:r.device_brand});t.push({name:"os版本号",value:r.os_version});t.push({name:"网络类型",value:r.access});t.push({name:"运营商",value:r.access_subtype});t.push({name:"分辨率",value:r.resolution});t.push({name:"screenWidth",value:e.screenWidth});t.push({name:"screenHeight",value:e.screenHeight});t.push({name:"pixelRatio",value:e.pixelRatio});for(var n="",i=0;i<t.length;i++){var o=t[i];n+=o.name+": "+o.value+"; "}D().v("调试辅助信息: ",n)}var i=!1,r={};r.sdk_type="wxgamemp";r.platform="wx";var o=le.getAppInfoSync();r.appid=o.appId;r.app_env=o.appEnv;r.app_version=o.appVersion;return{init:function(){e(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var e={};_e.forEach(function(t){e[t]=r[t]});return e},setIdTracking:function(e){this.setItem("id_tracking",e)},setIdType:function(e){this.setItem("id_type",e)},setItem:function(e,t){r[e]=t},getItem:function(e){return r[e]},updateExtraInfo:function(){V.getDeviceInfo(function(e){r.device_info=e||""})}}}var t=null;return{instance:function(){t||(t=e());return t}}}(),me={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},Ee=function(){function e(){return{resume:function(e){var t=!1;u||(u=C().get(M.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!u||!u.end_time||o-u.end_time>M.SESSION_INTERVAL){t=!0;n(e);D().v("开始新的session(%s): ",u.id,u)}else D().v("延续上一次session(%s): %s ",u.id,i.toLocaleTimeString(),u);return t},pause:function(){i()},getCurrentSessionId:function(){return(u||{}).id},getCurrentSession:function(){return u},cloneCurrentSession:function(){return ie.clone(u)}}}function t(e){var t={};for(var n in e)0===n.indexOf("_um_")&&(t[n]=e[n]);return t}function n(e){try{var n=(u||{}).options||{},i=ie.assign({},t(e.query));i.path=e.path||n.path;i.scene=e.scene?ye.instance().getPlatform()+"_"+e.scene:n.scene;var r=e.referrerInfo;r&&(i.referrerAppId=r.appId);D().v("session options: ",i);var o=i[M.UM_SSRC];o&&ue().setShareSource(o);var s=Date.now();u={id:ie.getRandomStr(10)+s,start_time:s,options:i}}catch(e){D().e("生成新session失败: ",e)}}function i(){if(u){var e=new Date;u.end_time=e.getTime();"number"!=typeof u.duration&&(u.duration=0);u.duration=u.end_time-o;C().set(M.CURRENT_SESSION,u);D().v("退出会话(%s): %s ",u.id,e.toLocaleTimeString(),u)}}var r=null,o=null,u=null;return function(){r||(r=e());return r}}(),Ie={sessions:"sn",ekvs:"e",active_user:"active_user"},Se={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn"},Te={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"puid"},Ne="_UMTEST_",Ae="TEST_TOKEN",Oe=function(){function e(){this.init=function(e){le.getClipboard(function(t){n=C().get(Ae);try{if(t&&ie.startsWith(t,Ne)&&t.split(Ne)[1]){var i=t.split(Ne)[1],r=JSON.parse(i).token;if(r){n=r;C().set(Ae,r)}}}catch(e){D().v(e)}e(!!n)})};this.getToken=function(){return n};this.clear=function(){n="";C().remove(Ae)}}var t=null,n="";return function(){t||(t=new e);return t}}(),we=function(){function e(t,n,i){if(ye.instance().isLoaded()){n=n||{};var r=g(t),o=ye.instance().getRealtimeFields();r.header=ie.assign({},r.header,o);r.noCache=n.noCache;a.enqueue(r);"function"==typeof i&&i()}else setTimeout(function(){e(t,n,i)},100)}function t(e){var i=a.front(),r=function(){a.dequeue();t(e)},o=function(){var n=a.dequeue();n&&!n.noCache&&s.push(n);t(e)};if(i)T(i,r,o);else{n();e()}}function n(){s.forEach(function(e){a.enqueue(e)});s.length=0}function i(e){if(re().getId())if(u)D().i("队列正在发送中");else{u=!0;t(function(){u=!1;"function"==typeof e&&e()})}else{D().i("获取id标识失败，暂缓发送");"function"==typeof e&&e()}}function r(){this.send=function(e,t,n){e?this.add(e,t,function(){i(n)}):i(n)};this.add=function(t,n,i){e(t,n,i)};this.load=function(){var e=C().get(M.REQUESTS);e&&e.length&&e.forEach(function(e){a.enqueue(e)});C().remove(M.REQUESTS)};this.save=function(){C().set(M.REQUESTS,ie.clone(a.items()));a.clear()}}var o=null,u=!1,s=[],a=new O(50);return function(){o||(o=new r);return o}}(),Re=function(){function e(){function e(e,t){var i=b().appKey(),r=ye.instance().getSDKType(),o=re().getId(),u=re().getIdType();if(i&&r&&o&&u){var s={ak:b().appKey(),sdt:ye.instance().getSDKType(),uin:e.nickName,uia:e.avatar,uig:e.gender,uit:e.country,uip:e.province,uic:e.city,uil:e.language,id:re().getId(),it:re().getIdType()},a=JSON.stringify(s);a=ie.base64Encode(a);n({url:M.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+a,success:function(n){D().v("用户信息上传成功: ",e);t&&t(n&&n.data&&200===n.data.code)},fail:function(){D().e("用户信息上传失败: ",e);t&&t(!1)}})}}this.update=function(){le.getUserInfo(function(t){if(t){var n=C().get(M.USER_INFO);n&&ie.deepEqual(t,n)||e(t,function(e){e&&C().set(M.USER_INFO,t)})}})}}var t=null;return function(){t||(t=new e);return t}}(),ke=[];k.prototype={createMethod:function(e,t,n){try{e[t]=n?function(){return n[t].apply(n,arguments)}:function(){ke.push([t,[].slice.call(arguments)])}}catch(e){D().v("create method errror: ",e)}},installApi:function(e,t){try{var n=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];n.push("onShareAppMessage","shareAppMessage");var i,r;for(i=0,r=n.length;i<r;i++)this.createMethod(e,n[i],t);if(t)for(i=0,r=ke.length;i<r;i++){var o=ke[i];try{t[o[0]].apply(t,o[1])}catch(e){D().v("impl[v[0]].apply error: ",o[0],e)}}}catch(e){D().v("install api errror: ",e)}}};var Ue={init:function(e){wx.onShow(function(t){D().v("game onShow: ",t);e.resume(t)});wx.onHide(function(){D().v("game onHide");e.pause()})}},De=new k,Pe={_inited:!1,init:function(e){if(this._inited)D().v("已经实例过，请避免重复初始化");else if(e)if(e.appKey){"boolean"!=typeof e.useOpenid&&(e.useOpenid=!0);b().set(e);D().setDebug(e.debug);this._inited=!0;var t=this;if(b().useOpenid()){D().tip_w("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");D().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取");D().tip_w("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")}!function(e){try{var t=new R;D().v("成功创建Lib对象");t.init(function(){D().v("Lib对象初始化成功");De.installApi(e,t);D().v("安装Lib接口成功")})}catch(e){D().w("创建Lib对象异常: "+e)}}(t)}else D().err("请确保传入正确的appkey");else D().err("请通过在App内添加umengConfig设置相关信息！")}};try{De.installApi(Pe,null);Ue.init(Pe);D().v("安装临时接口成功");wx.uma=Pe}catch(e){D().w("uma赋值异常: ",e)}module.exports=Pe;
