module.exports = (function() {
var __MODS__ = {};
var __DEFINE__ = function(modId, func, req) { var m = { exports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };
var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = { exports: {} }; __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); if(typeof m.exports === "object") { __MODS__[modId].m.exports.__proto__ = m.exports.__proto__; Object.keys(m.exports).forEach(function(k) { __MODS__[modId].m.exports[k] = m.exports[k]; var desp = Object.getOwnPropertyDescriptor(m.exports, k); if(desp && desp.configurable) Object.defineProperty(m.exports, k, { set: function(val) { __MODS__[modId].m.exports[k] = val; }, get: function() { return __MODS__[modId].m.exports[k]; } }); }); if(m.exports.__esModule) Object.defineProperty(__MODS__[modId].m.exports, "__esModule", { value: true }); } else { __MODS__[modId].m.exports = m.exports; } } return __MODS__[modId].m.exports; };
var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };
var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };
__DEFINE__(1582182478297, function(require, module, exports) {
function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function MD5(e){return e?md5(e):""}function encode$1(e){return base64.encode(e,!1)}function decode$1(e){return base64.decode(e)}function checkEmptyArgument(e){return e.length&&this.checkId(e[0])}function checkId(e){return e&&"string"==typeof e}function getRandomStr(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r=0;r<Number(e);r++)t+=n[Math.round(Math.random()*(n.length-1))];return t}function isNumber(e){return!Number.isNaN(parseInt(e,10))}function compareVersion(e,t){for(var n=String(e).split("."),r=String(t).split("."),o=0;o<Math.max(n.length,r.length);o++){var i=parseInt(n[o]||0,10),a=parseInt(r[o]||0,10);if(i>a)return 1;if(i<a)return-1}return 0}function checkMD5(e,t){try{return e===md5(t)}catch(e){return!1}}function send(e){try{mpServer().mpServerless().network.forward(constants.ALIYUN_URL,e.data).then(function(t){e.complete&&e.complete();e.success&&e.success({status:200,data:t.result})}).catch(function(e){ulog().e("mpServerless--error",e)})}catch(t){e.complete&&e.complete();e.fail&&e.fail()}}function urequest(e){try{udevice.getNetworkInfo(function(t){if("NOTREACHABLE"==t.networkType||"none"==t.networkType||0==t.networkAvailable){ulog().e("请求失败:暂无网络 ");e.fail()}else send(e)},e.fail)}catch(e){ulog().e("请求失败: "+e)}}function send$1(e,t,n,r){if(Header.getInstance().isLoaded()){var o=Header.getInstance().get();if(e.header){var i=e.header;for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&(o[e]=i[e])}e.header=o;_request(e,t,n,r)}else setTimeout(function(){send$1(e,t,n,r)},100)}function _request(e,t,n,r){ulog().i("开始发送数据",JSON.stringify(e));e=jsonUtil.stringify(e);const o=_getHeader();var i={url:constants.LOG_URL,method:"POST",data:utils.encode(e),success:function(e){var r=e.code||e.status||e.statusCode;if(200===r||413===r){ulog().i("数据发送成功: ",r);_dealImprint((e.data||{}).imprint);"function"==typeof t&&t()}else"function"==typeof n&&n()},fail:function(e){ulog().w("数据发送失败: ",e);"function"==typeof n&&n()},complete:function(){"function"==typeof r&&r()}};urequest(Object.assign(i,o))}function _getHeader(){;"wxmp/json";return{header:{"Content-Type":"wxmp/json","Msg-Type":"wxmp/json"}}}function _dealImprint(e){try{if(e){cache().set(constants.IMPRINT_KEY,e);Header.getInstance().setItem("imprint",e);var t=jsonUtil.parse(utils.decode(e)),n=t.report_policy;if(n&&utils.isNumber(n)){cache().set(constants.REPORT_POLICY,n);if(n===constants.REPORT_POLICY_INTERVAL){var r=t.report_interval;if(r&&utils.isNumber(r)){r<=constants.EVENT_SEND_MIN_INTERVAL?r=constants.EVENT_SEND_MIN_INTERVAL:r>constants.EVENT_SEND_MAX_INTERVAL&&(r=constants.EVENT_SEND_MAX_INTERVAL);cache().set(constants.REPORT_INTERVAL_TIME,r)}}}}}catch(e){}}function UmengAnalysisLib(){this._inited=!1;this._resumed=!1;this._preLastSendTime=0;this._sending=!1}function SdkUpdater(){}var modules={},alipay=function(){function e(){this.my=function(){return n||my||{}};this.setMy=function(e){n=e}}var t=null,n=null;return function(){t||(t=new e);return t}}(),BuildTarget={ALIPAY:"alipay",QUICKAPP:"quickapp",WEIXIN:"wx",TARGET:"wx"},BuildTarget_1=BuildTarget,ulog=function(){function e(){this.setDebug=function(e){n=e};this.d=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.debug.apply(console,arguments)}catch(e){}};this.i=function(){try{if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.info.apply(console,arguments)}catch(e){}}catch(e){}};this.e=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.error.apply(console,arguments)}catch(e){}};this.w=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.warn.apply(console,arguments)}catch(e){}};this.v=function(){if(n)try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.t=function(){if(n)try{console.table.apply(console,arguments)}catch(e){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.info.apply(console,arguments)}catch(e){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]="[SDK] -- "+arguments[0]);console.error.apply(console,arguments)}catch(e){}}}var t=null,n=!1;return function(){null===t&&(t=new e);return t}}(),qaStorage=modules.storage,ustorage={set:function(e,t,n,r){var o,i={key:e,success:function(e){"function"==typeof n&&n(e)},fail:function(e,t){"function"==typeof r&&r(e,t)}};switch("wx"){case BuildTarget_1.ALIPAY:o=alipay().my().setStorageSync;i.data=t;break;case BuildTarget_1.QUICKAPP:i.value=t;o=qaStorage.set;break;case BuildTarget_1.WEIXIN:this._wxSetStorage(e,t);return}try{o&&o(i)}catch(e){ulog.e("存储错误",e)}},_wxSetStorage:function(e,t){try{wx.setStorageSync(e,t)}catch(e){ulog.e("存储错误",e)}},get:function(e,t,n){var r;switch("wx"){case BuildTarget_1.ALIPAY:r=alipay().my().getStorage;break;case BuildTarget_1.QUICKAPP:r=qaStorage.get;break;case BuildTarget_1.WEIXIN:r=wx.getStorage}try{r&&r({key:e,fail:function(e,t){"function"==typeof n&&n(e,t)},complete:function(e){"function"==typeof t&&t(e.data)}})}catch(e){ulog.e("获取storage错误",e)}},remove:function(e,t,n){var r;switch("wx"){case BuildTarget_1.ALIPAY:r=alipay().my().removeStorage;break;case BuildTarget_1.QUICKAPP:r=qaStorage.delete;break;case BuildTarget_1.WEIXIN:r=wx.removeStorage}try{r&&r({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof n&&n(!1)}})}catch(e){ulog.e("删除storage错误",e)}}},jsonUtil={stringify:function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},parse:function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},parseToArray:function(e){if(e)try{return JSON.parse(e)}catch(e){}return[]}},cache=function(){function e(e){this.load=function(t){n=e+"_"+n;if(r){ustorage.remove(n);t()}else ustorage.get(n,function(e){ustorage.remove(n);r=jsonUtil.parse(e)||{};o=!0;t()})};this.save=function(){r&&ustorage.set(n,jsonUtil.stringify(r),null,function(e,t){ulog().e("cache save failed: ",t,e)})};this.set=function(e,t){r&&(r[e]=t)};this.get=function(e){return(r||{})[e]};this.remove=function(e){r&&r[e]&&delete r[e]};this.clear=function(){r=null};this.has=function(e){return!!this.get(e)};this.isLoaded=function(){return o}}var t=null,n="umeng_cache",r=null,o=!1;return function(n){t||(t=new e(n));return t}}(),LOG_SEND_HOST_PRE="https://preulogs.umeng.com/mpp_logs",SDK_UPDATE_HOST_PRODUCT="https://s.cnzz.com",logSendUrl=LOG_SEND_HOST_PRE,sdkUpdateUrl=SDK_UPDATE_HOST_PRODUCT,IS_ALIYUN=!0,constants={NO_SEND_REQUESTS_KEY:"no_send_reqs",SESSION_INTERVAL:0,LOG_URL:logSendUrl,EVENT_PREFIX_KEY:"ekv_",HALF_SESSION_PREFIX_KEY:"halfSession_",CLOSE_SESSION_PREFIX_KEY:"closeSession_",REQUEST_TYPE_SESSION_HALF:1,REQUEST_TYPE_SESSION_CLOSE:2,REQUEST_TYPE_EVENT:3,DEBUG:!0,DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",EVENT_SEND_MIN_INTERVAL:5,EVENT_SEND_MAX_INTERVAL:86400,EVENT_LAST_SEND_TIME_KEY:"last_send_time",REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT_KEY:"imprint",DOWNLOAD_FILE_FIRST_CACHE:"hot_update_first",DOWNLOAD_FILE_SECOND_CACHE:"hot_update_second",SDK_UPDATE_SERVER_ADDRESS:sdkUpdateUrl+"/sdk/quickapp",SDK_UPDATE_LOCAL_STORAGE_PATH:"internal://files/umengsdk/",SDK_CODE:"umeng_sdk_cache",SDK_INFO:"umeng_sdk_info",SEED_VERSION:"1.0.0",IMPL_VERSION:"1.0.0_aliyun",ALIPAY_AVAILABLE:"10.1.52",UM_EMPTY_FLAGE:"um_id_empty_",UM_FAKE_ID:"um_fake_id",IS_ALIYUN:IS_ALIYUN,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},md5=createCommonjsModule(function(e){!function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function r(e,t){return e<<t|e>>>32-t}function o(e,t,o,i,a,s){return n(r(n(n(t,e),n(i,s)),a),o)}function i(e,t,n,r,i,a,s){return o(t&n|~t&r,e,t,i,a,s)}function a(e,t,n,r,i,a,s){return o(t&r|n&~r,e,t,i,a,s)}function s(e,t,n,r,i,a,s){return o(t^n^r,e,t,i,a,s)}function c(e,t,n,r,i,a,s){return o(n^(t|~r),e,t,i,a,s)}function u(e,t){e[t>>5]|=128<<t%32;e[14+(t+64>>>9<<4)]=t;var r,o,u,f,l,_=1732584193,d=-271733879,g=-1732584194,h=271733878;for(r=0;r<e.length;r+=16){o=_;u=d;f=g;l=h;d=c(d=c(d=c(d=c(d=s(d=s(d=s(d=s(d=a(d=a(d=a(d=a(d=i(d=i(d=i(d=i(d,g=i(g,h=i(h,_=i(_,d,g,h,e[r],7,-680876936),d,g,e[r+1],12,-389564586),_,d,e[r+2],17,606105819),h,_,e[r+3],22,-1044525330),g=i(g,h=i(h,_=i(_,d,g,h,e[r+4],7,-176418897),d,g,e[r+5],12,1200080426),_,d,e[r+6],17,-1473231341),h,_,e[r+7],22,-45705983),g=i(g,h=i(h,_=i(_,d,g,h,e[r+8],7,1770035416),d,g,e[r+9],12,-1958414417),_,d,e[r+10],17,-42063),h,_,e[r+11],22,-1990404162),g=i(g,h=i(h,_=i(_,d,g,h,e[r+12],7,1804603682),d,g,e[r+13],12,-40341101),_,d,e[r+14],17,-1502002290),h,_,e[r+15],22,1236535329),g=a(g,h=a(h,_=a(_,d,g,h,e[r+1],5,-165796510),d,g,e[r+6],9,-1069501632),_,d,e[r+11],14,643717713),h,_,e[r],20,-373897302),g=a(g,h=a(h,_=a(_,d,g,h,e[r+5],5,-701558691),d,g,e[r+10],9,38016083),_,d,e[r+15],14,-660478335),h,_,e[r+4],20,-405537848),g=a(g,h=a(h,_=a(_,d,g,h,e[r+9],5,568446438),d,g,e[r+14],9,-1019803690),_,d,e[r+3],14,-187363961),h,_,e[r+8],20,1163531501),g=a(g,h=a(h,_=a(_,d,g,h,e[r+13],5,-1444681467),d,g,e[r+2],9,-51403784),_,d,e[r+7],14,1735328473),h,_,e[r+12],20,-1926607734),g=s(g,h=s(h,_=s(_,d,g,h,e[r+5],4,-378558),d,g,e[r+8],11,-2022574463),_,d,e[r+11],16,1839030562),h,_,e[r+14],23,-35309556),g=s(g,h=s(h,_=s(_,d,g,h,e[r+1],4,-1530992060),d,g,e[r+4],11,1272893353),_,d,e[r+7],16,-155497632),h,_,e[r+10],23,-1094730640),g=s(g,h=s(h,_=s(_,d,g,h,e[r+13],4,681279174),d,g,e[r],11,-358537222),_,d,e[r+3],16,-722521979),h,_,e[r+6],23,76029189),g=s(g,h=s(h,_=s(_,d,g,h,e[r+9],4,-640364487),d,g,e[r+12],11,-421815835),_,d,e[r+15],16,530742520),h,_,e[r+2],23,-995338651),g=c(g,h=c(h,_=c(_,d,g,h,e[r],6,-198630844),d,g,e[r+7],10,1126891415),_,d,e[r+14],15,-1416354905),h,_,e[r+5],21,-57434055),g=c(g,h=c(h,_=c(_,d,g,h,e[r+12],6,1700485571),d,g,e[r+3],10,-1894986606),_,d,e[r+10],15,-1051523),h,_,e[r+1],21,-2054922799),g=c(g,h=c(h,_=c(_,d,g,h,e[r+8],6,1873313359),d,g,e[r+15],10,-30611744),_,d,e[r+6],15,-1560198380),h,_,e[r+13],21,1309151649),g=c(g,h=c(h,_=c(_,d,g,h,e[r+4],6,-145523070),d,g,e[r+11],10,-1120210379),_,d,e[r+2],15,718787259),h,_,e[r+9],21,-343485551);_=n(_,o);d=n(d,u);g=n(g,f);h=n(h,l)}return[_,d,g,h]}function f(e){var t,n="",r=32*e.length;for(t=0;t<r;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];n[(e.length>>2)-1]=void 0;for(t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function _(e){return f(u(l(e),8*e.length))}function d(e,t){var n,r,o=l(e),i=[],a=[];i[15]=a[15]=void 0;o.length>16&&(o=u(o,8*e.length));for(n=0;n<16;n+=1){i[n]=909522486^o[n];a[n]=1549556828^o[n]}r=u(i.concat(l(t)),512+8*t.length);return f(u(a.concat(r),640))}function g(e){var t,n,r="";for(n=0;n<e.length;n+=1){t=e.charCodeAt(n);r+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t)}return r}function h(e){return unescape(encodeURIComponent(e))}function E(e){return _(h(e))}function S(e){return g(E(e))}function p(e,t){return d(h(e),h(t))}function v(e,t){return g(p(e,t))}function I(e,t,n){return t?n?p(t,e):v(t,e):n?E(e):S(e)}e.exports?e.exports=I:t.md5=I}(commonjsGlobal)}),b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[b64chars.charAt(n>>>18),b64chars.charAt(n>>>12&63),t>=2?"=":b64chars.charAt(n>>>6&63),t>=1?"=":b64chars.charAt(63&n)].join("")},btoa=function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return fromCharCode(55296+(t>>>10))+fromCharCode(56320+(1023&t));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,n=t%4,r=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),o=[fromCharCode(r>>>16),fromCharCode(r>>>8&255),fromCharCode(255&r)];o.length-=[0,0,2,1][n];return o.join("")},atob=function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},base64={encode:encode,decode:decode},utils={MD5:MD5,encode:encode$1,decode:decode$1,checkEmptyArgument:checkEmptyArgument,checkId:checkId,isNumber:isNumber,checkMD5:checkMD5,compareVersion:compareVersion,getRandomStr:getRandomStr},udevice={getAlipaySystemInfoSync:function(){try{return alipay().my().getSystemInfoSync()}catch(e){ulog().err("获取SystemInfo异常")}},getSystemInfo:function(e,t){wx.getSystemInfo({success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(e){"function"==typeof e&&e()},getNetworkInfo:function(e,t){var n={success:function(t){"function"==typeof e&&e(t)},fail:function(){"function"==typeof t&&t()}};wx.getNetworkType(n)},getLaunchParam:function(){return wx.getLaunchOptionsSync()},getDeviceId:function(e,t){try{"function"==typeof e&&e("")}catch(e){ulog().e("getDeviceId error")}},getAdvertisingId:function(e,t){"function"==typeof e&&e("")},getUserId:function(e){try{e("")}catch(t){e("")}},getUniqueId:function(e){var t=cache().get("umeng_uniqueid");t?"function"==typeof e&&e(t):this._buildUniqueId(e)},getPageName:function(){},onNetworkStatusChange:function(e){wx.onNetworkStatusChange(function(t){"function"==typeof e&&e(t.isConnected||!0)})},getFakeUniqueId:function(){var e=cache().get(constants.UM_FAKE_ID);e||(e=this._buildFakeUniqueId());return e},_buildFakeUniqueId:function(){var e=constants.UM_EMPTY_FLAGE+(new Date).getTime()+utils.getRandomStr(10);cache().set(constants.UM_FAKE_ID,e);return e},_buildUniqueId:function(e){var t=this;t.getDeviceId(function(n){t.getAdvertisingId(function(r){t.getUserId(function(t){var o=n||r||t;cache().set(constants.ADVERTISING_ID,r);cache().set(constants.ANDROID_ID,n);cache().set("umeng_uniqueid",o);e(o)})})})}},PRE_PAGE_KEY="page_",PageController=function(){this._pagelist=[];this._currentPage={};this.hasTracked=!1};PageController.prototype={startPage:function(e){if(e&&!this.hasTracked){this._currentPage={ts:Date.now(),page_name:e};this.hasTracked=!0}},endPage:function(e,t){if(this.hasTracked&&e&&t&&this._currentPage&&t===this._currentPage.page_name){var n=Date.now()-this._currentPage.ts;this._currentPage.duration=Math.abs(n);this._pagelist=this._pagelist.concat(this._currentPage);this._currentPage=null;this.savePages(e);this.hasTracked=!1}},savePages:function(e){e&&this._pagelist.length>0&&this.updateStorage(PRE_PAGE_KEY+e,this._pagelist)},getPages:function(e){var t=cache().get(PRE_PAGE_KEY+e),n=jsonUtil.parseToArray(t).concat(this._pagelist);this.clear(e);return n},updateStorage:function(e,t){if(Array.isArray(t)&&t.length>0){var n=cache().get(e);t=jsonUtil.parseToArray(n).concat(t);cache().set(e,jsonUtil.stringify(t));this._pagelist.length=0}},clear:function(e){cache().remove(PRE_PAGE_KEY+e);this._pagelist=[]}};var CLOSED_SESSIONS_KEY="closed_sessions",HALF_SESSIONS_KEY="half_sessions",CURRENT_SESSION_KEY="current_session",PAGE_END_TIME_KEY="page_endtime",Session=function(){function e(){return{trackPageStart:function(e){l.startPage(e)},trackPageEnd:function(e){l.endPage((a||{}).id,e)},getCurrentSessionId:function(){return(a||{}).id},getCurrentSession:function(){return a},getSessions:function(){return jsonUtil.parseToArray(cache().get(CLOSED_SESSIONS_KEY))},getHalfSessions:function(){return jsonUtil.parseToArray(cache().get(HALF_SESSIONS_KEY))},resume:function(e,t){c=e;u=t;n()},pause:function(){if(a){s=Date.now();a.end_time=s;cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(a));cache().set(PAGE_END_TIME_KEY,s);r(s);a=null;cache().remove(CURRENT_SESSION_KEY)}},clearSessions:function(){cache().remove(CLOSED_SESSIONS_KEY)},clearHalfSession:function(){cache().remove(HALF_SESSIONS_KEY)}}}function t(e){var t=Date.now();udevice.getUniqueId(function(n){var r=utils.MD5(t+":::"+c+":::"+n);e(r)})}function n(){var e=Date.now(),t=jsonUtil.parse(cache().get(CURRENT_SESSION_KEY)),n=cache().get(PAGE_END_TIME_KEY),i=a||t,c=s||n;if(i){if(c&&e-c>constants.SESSION_INTERVAL){r(c);o()}}else o()}function r(e){try{a.end_time||(a.end_time=parseInt(e,10));var t=e-a.start_time;a.duration=t;var n=l.getPages(a.sessionId);if(Array.isArray(n)&&n.length>0){a.pages=n;a.$page_num=n.length}var r=cache().get(CLOSED_SESSIONS_KEY),o=jsonUtil.parseToArray(r).concat(a);cache().set(CLOSED_SESSIONS_KEY,jsonUtil.stringify(o))}catch(e){ulog().e("closeSession failed: ",e)}}function o(){t(function(e){a={id:e,start_time:Date.now()};cache().set(CURRENT_SESSION_KEY,jsonUtil.stringify(a));i()})}function i(){if(a){var e=cache().get(HALF_SESSIONS_KEY);e=jsonUtil.parseToArray(e).concat(a);cache().set(HALF_SESSIONS_KEY,jsonUtil.stringify(e));"function"==typeof u&&u(a.id)}}var a,s,c="",u=null,f=null,l=new PageController;return{getInstance:function(){f||(f=e());return f}}}(),MOBILE_NETWORK_2G="2g",MOBILE_NETWORK_3G="3g",MOBILE_NETWORK_4G="4g",MOBILE_NETWORK_NONE="none",BLANK_SPACE=" ",UMENG_ADVERTISTING_ID="idfa",UMENG_ANDROID_ID="android_id",Header=function(){function e(){function e(e,i){udevice.getSystemInfo(function(s){udevice.getUniqueId(function(c){udevice.getNetworkInfo(function(u){var f=u.type||u.networkType;f===MOBILE_NETWORK_NONE&&(f="unknown");var l=cache().get(constants.IMPRINT_KEY);l&&(a.imprint=l);var _=cache().get(constants.ADVERTISING_ID);if(_){var d=t(_);if(d){var g=n(UMENG_ADVERTISTING_ID,d);a.id_tracking=g}}var h=cache().get(constants.ANDROID_ID);if(h){var E=t(h);E&&(a.id_tracking&&a.id_tracking.snapshots?a.id_tracking.snapshots[UMENG_ANDROID_ID]=E:a.id_tracking=n(UMENG_ANDROID_ID,E))}r(e,s,c,f);o(s);i()})})})}function t(e){if(e)return{identity:e,version:1,ts:Date.now()}}function n(e,t){var n={snapshots:{}};n.snapshots[e]=t;return n}function r(e,t,n,r){a.device_type="Phone";a.sdk_version=constants.IMPL_VERSION;a.appkey=e;n||"wx"!==BuildTarget_1.WEIXIN||(n=s);a.idmd5=utils.MD5(n);a.pro_ver="1";if(t){var o,i,c,u=t.model,f=t.brand,l=f.toLowerCase();a.sdk_type="wxmp";a.platform="wxmp";a.platform_version=t.version;c=(o=t.screenWidth*t.pixelRatio)>(i=t.screenHeight*t.pixelRatio)?o+"*"+i:i+"*"+o;a.os=t.platform;a.font_size_setting=t.fontSizeSetting;a.device_model=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;a.device_brand=f;a.device_manufacturer=l;a.device_manuid=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;a.device_name=u.toLowerCase().indexOf(l)>-1?u:l+BLANK_SPACE+u;a.os_version=t.system;a.resolution=c;a.language=t.language}switch(r){case MOBILE_NETWORK_4G:a.access_subtype="LTE";a.access="2G/3G";break;case MOBILE_NETWORK_3G:a.access_subtype="CDMA";a.access="2G/3G";break;case MOBILE_NETWORK_2G:a.access_subtype="GRPS";a.access="2G/3G";break;default:a.access=r;delete a.access_subtype}}function o(e){var t=[];if(e){t.push({name:"系统名",value:e.platform});t.push({name:"支付宝版本号",value:e.version})}t.push({name:"设备型号",value:a.device_model});t.push({name:"设备生产商",value:a.device_brand});t.push({name:"os版本号",value:a.os_version});t.push({name:"网络类型",value:a.access});t.push({name:"运营商",value:a.access_subtype});t.push({name:"分辨率",value:a.resolution});for(var n="",r=0;r<t.length;r++){var o=t[r];n+=o.name+": "+o.value+"; "}ulog().v("info: ",n)}var i=!1,a={},s=udevice.getFakeUniqueId();return{init:function(t){e(t,function(){i=!0})},isLoaded:function(){return i},get:function(){return JSON.parse(JSON.stringify(a))},setItem:function(e,t){a[e]=t},getItem:function(e){return a[e]},updateExtraInfo:function(){udevice.getDeviceInfo(function(e){a.device_info=e||""})}}}var t=null;return{getInstance:function(){t||(t=e());return t}}}(),mpServer=function(){function e(){this.mpServerless=function(){return n||{}};this.setMpServerless=function(e){n=e}}var t=null,n=null;return function(){t||(t=new e);return t}}(),EKVS_KEY="ekvs",EVENT_MAX_COUNT=1e4,MEMORY_DATA_COUNT=1,EventManager=function(){function e(e,t){var n={id:e,ts:Date.now()};switch(typeof t){case"string":n[e]=t;break;case"object":for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}function t(e){if(e)if(Session.getInstance().getCurrentSessionId()){s.unshift(e);s.length>=MEMORY_DATA_COUNT&&r()}else{ulog().w("session id is null");c.unshift(e)}}function n(e){var t=0;e.forEach(function(e){for(var n in e)e[n]&&(t+=e[n].length)});return t}function r(){if(s.length){var e=jsonUtil.parseToArray(cache().get(EKVS_KEY));if(n(e)+s.length<=EVENT_MAX_COUNT){var t=o(e,s);cache().set(EKVS_KEY,jsonUtil.stringify(t))}s.length=0}}function o(e,t){for(var n=Session.getInstance().getCurrentSessionId(),r=0,o=[];r<e.length&&!(o=e[r][n]);r++);if(Array.isArray(o)&&o.length)e[r][n]=o.concat(t);else{var i={};i[n]=t;e.push(i)}return e}function i(){this.getEkvs=function(){var e=this.readEkvs();s&&s.length&&(e=o(e,s));return e};this.readEkvs=function(){var e=[],t=cache().get(EKVS_KEY);t&&(e=jsonUtil.parseToArray(t));return e};this.clearEkvs=function(){cache().remove(EKVS_KEY);s.length=0};this.addEvent=function(n,r){t(e(n,r))};this.cacheEvent=function(t,n){var r=e(t,n);u.push(r)};this.syncCache=function(){for(var e=0;e<u.length;e++)t(u[e]);u.length=0};this.addSessionId=function(){var e=Session.getInstance().getCurrentSessionId();if(Array.isArray(c)&&c.length&&e){for(var n=0;n<c.length;n++)t(c[n]);c.length=0}};this.quit=function(){if(s.length){var e=cache().get(EKVS_KEY),t=o(jsonUtil.parseToArray(e),s);cache().set(EKVS_KEY,jsonUtil.stringify(t));s.length=0}}}var a,s=[],c=[],u=[];return{getInstance:function(){a||(a=new i);return a}}}();UmengAnalysisLib.prototype={init:function(e,t,n){ulog().v("sdk version: "+constants.IMPL_VERSION);if(this._inited)ulog().v("Lib重复实例化");else if(e){var r=this;cache(e).load(function(){ulog().v("cache加载成功");r._init(e,t);r._inited=!0;"function"==typeof n&&n();ulog().tip("SDK集成成功")})}else{this._inited=!1;ulog().err("appkey不能为空，请确保传入正确的appkey")}},_init:function(e,t){this._appKey=e;Header.getInstance().init(e);t&&t.query&&t.query.sdk_channel&&Header.getInstance().setItem("channel",t.query.sdk_channel);ulog().v("Header初始化成功");this._bindAuthChange();this._handleQuit()},_bindAuthChange:function(){},_handleQuit:function(){},resume:function(e){if(this._inited&&!this._resumed){this._resumed=!0;e&&this.trackPageStart(e);var t=this;Session.getInstance().resume(this._appKey,function(e){ulog().v("创建新会话: "+e);EventManager.getInstance().addSessionId();t._sendHalfSessions();t._sendEkvs()})}},pause:function(e){if(this._inited&&this._resumed){this._resumed=!1;e&&this.trackPageEnd(e);Session.getInstance().pause();EventManager.getInstance().quit();cache().save();this._sendHalfSessions();this._sendEkvs();ulog().v("退出会话")}},trackEvent:function(e,t){if(this._inited)if(utils.checkId(e))if(t&&"[object Object]"!==Object.prototype.toString.call(t)&&"[object String]"!==Object.prototype.toString.call(t))ulog().e("please check trackEvent attr. attr should be string or object(not include Array)");else{ulog().v("event id: "+jsonUtil.stringify(e)+(t?" || event attr: "+jsonUtil.stringify(t):""));if(!1===this._sending){EventManager.getInstance().addEvent(e,t);this._sendPolicy()}else EventManager.getInstance().cacheEvent(e,t)}else ulog().e("event id should be string and can not be null")},trackPageStart:function(e){this._inited&&Session.getInstance().trackPageStart(e)},trackPageEnd:function(e){this._inited&&Session.getInstance().trackPageEnd(e)},_sendPolicy:function(){var e=cache().get(constants.REPORT_POLICY);if(e&&e===constants.REPORT_POLICY_INTERVAL){var t=cache().get(constants.REPORT_INTERVAL_TIME),n=cache().get(constants.EVENT_LAST_SEND_TIME_KEY),r=!n,o=Date.now();t=t||constants.EVENT_SEND_MIN_INTERVAL;var i=o-n;if(r=r||i>1e3*t){var a=this;a._updateLastSendTime(o);a._sendEkvs(null,function(){a._recoverLastSendTime()})}}},_updateLastSendTime:function(e){this._preLastSendTime=cache().get(constants.EVENT_LAST_SEND_TIME_KEY);cache().set(constants.EVENT_LAST_SEND_TIME_KEY,e)},_recoverLastSendTime:function(){cache().set(constants.EVENT_LAST_SEND_TIME_KEY,this._preLastSendTime)},_sendHalfSessions:function(){var e=Session.getInstance().getHalfSessions();e&&e.length&&send$1({header:{st:"1"},analytics:{sessions:e}},function(){Session.getInstance().clearHalfSession()})},_sendEkvs:function(e,t){var n=this,r={},o=Session.getInstance().getSessions();Array.isArray(o)&&o.length&&(r.sessions=o);var i=EventManager.getInstance().getEkvs();Array.isArray(i)&&i.length&&(r.ekv=i);if(r.sessions||r.ekv){var a={analytics:r},s=function(){Session.getInstance().clearSessions();EventManager.getInstance().clearEkvs();EventManager.getInstance().syncCache();cache().save();e&&e()};n._sending=!0;send$1(a,s,t,function(){n._sending=!1})}}};var STATUS={SUCCESS:0,FAIL:-1},modules$1={md5:md5,base64:base64},callQueue=[];SdkUpdater.prototype={loadSDK:function(e){var t=this;try{ustorage.get(constants.SDK_INFO,function(n){n&&n.md5?t.readSDKCode(n,function(t,r){e(t,r,n)}):e(STATUS.FAIL)})}catch(t){e(STATUS.FAIL)}},readSDKCode:function(e,t){try{ulog().v("current sdk:"+e.version+e.md5+e.filePath);ustorage.get(constants.SDK_CODE,function(n){var r=utils.decode(n);utils.checkMD5(e.md5,r)?t(STATUS.SUCCESS,r):t(STATUS.FAIL)},function(){t(STATUS.FAIL)})}catch(e){t(STATUS.FAIL)}},downloadSDK:function(e){try{urequest({url:e.fileUrl,dataType:"text",success:function(t){try{var n=t.data;"string"==typeof n&&n.length>0&&utils.checkMD5(e.md5,n)&&ustorage.set(constants.SDK_CODE,utils.encode(n),function(){ustorage.set(constants.SDK_INFO,e)},function(){ustorage.remove(constants.SDK_CODE);ustorage.remove(constants.SDK_INFO)})}catch(e){ulog().w("sdk保存时遇到异常: "+e)}},fail:function(){}})}catch(e){}},checkVersionNew:function(e){var t=this;udevice.getSystemInfo(function(n){e.systemInfo=n;urequest({url:constants.SDK_UPDATE_SERVER_ADDRESS,method:"POST",data:e,success:function(e){if(200===e.status)try{var n=e.data;if(200===n.code&&n.data&&n.data.update){var r=n.data.info;r&&r.fileUrl&&r.md5&&t.downloadSDK(r)}}catch(e){ulog().w("check new version error: request failed")}},fail:function(e,t){ulog().w("check new version fail",e,t)},complete:function(){ulog().v("check new version complete")}})})},createMethod:function(e,t,n){try{e[t]=n?function(){return n[t].apply(n,arguments)}:function(){callQueue.push([t,[].slice.call(arguments)])}}catch(e){ulog().v("create method errror: ",e)}},installApi:function(e,t){try{var n,r,o=["resume","pause","trackEvent","trackPageStart","trackPageEnd"];for(n=0,r=o.length;n<r;n++)this.createMethod(e,o[n],t);if(t)for(n=0,r=callQueue.length;n<r;n++){var i=callQueue[n];t[i[0]].apply(t,i[1])}}catch(e){ulog().v("install api errror: ",e)}},compileModule:function(sdkCode){var module={exports:{}},require=function(e){var t=e.split("/"),n=t[t.length-1];return modules$1[n]||{}};eval(sdkCode,require);return module.exports},loadModule:function(e,t){var n;if(e===STATUS.FAIL){n=UmengAnalysisLib;ulog().i("load sdk failed: use origin uma_impl")}else try{n=this.compileModule(t)}catch(e){n=UmengAnalysisLib;ulog().w("compileModule failed: use origin uma_impl")}return n}};var umengAnalysis={_inited:!1,_initParam:function(){var e=Array.prototype.slice.call(arguments),t={appKey:e[0]};t.options=e[1]||{};return t},init:function(){var e=this._initParam.apply(this,arguments),t=e.appKey,n=(e.context,e.options),r=this;if(this._inited)ulog().v("已经实例过，请避免重复初始化");else{var o=new SdkUpdater;o.installApi(r,null);ulog().v("安装临时接口成功");if(t){this._setMPServerless(n);this._setOptions(n);this._inited=!0;try{var i=new UmengAnalysisLib;ulog().v("成功创建Lib对象");i.init(t,n.platformParam,function(){ulog().v("Lib对象初始化成功");o.installApi(r,i);ulog().v("安装Lib接口");"function"==typeof n.callback&&n.callback()})}catch(e){ulog().w("创建Lib对象异常: "+e)}}else ulog().err("appkey不能为空，请确保传入正确的appkey")}},_setMPServerless:function(e){mpServer().setMpServerless(e.mpServerless||{})},_setOptions:function(e){ulog().setDebug(e.debug)}};module.exports=umengAnalysis;

}, function(modId) {var map = {}; return __REQUIRE__(map[modId], modId); })
return __REQUIRE__(1582182478297);
})()
//# sourceMappingURL=index.js.map